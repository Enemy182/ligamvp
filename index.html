<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liga MVP - Temporada 22</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'], },
                    colors: {
                        darkbg: '#050B14', cardbg: '#0D1424', panelbg: '#162032',
                        brandcyan: '#00F0FF', brandpink: '#FF003C',
                    }
                }
            }
        }
    </script>
    <style>
        .text-gradient { background: linear-gradient(to right, #00F0FF, #FF003C); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .tab-content { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .tab-content.active { display: block; opacity: 1; }
        .glass-panel { background: rgba(13, 20, 36, 0.6); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.05); }
    </style>
</head>
<body class="bg-darkbg text-slate-200 min-h-screen antialiased selection:bg-brandcyan selection:text-black relative overflow-x-hidden">

    <div class="fixed top-[-10%] left-[-10%] w-[40%] h-[40%] bg-brandcyan/10 blur-[120px] rounded-full pointer-events-none z-0"></div>
    <div class="fixed bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-brandpink/10 blur-[120px] rounded-full pointer-events-none z-0"></div>

    <nav class="sticky top-0 z-50 w-full glass-panel border-b border-white/5 px-4 py-3 flex items-center justify-between shadow-xl">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-full overflow-hidden bg-panelbg flex items-center justify-center shrink-0 border border-white/10 shadow-[0_0_10px_rgba(0,240,255,0.2)]">
                <img src="logo.png" alt="Logo" class="w-full h-full object-contain" onerror="this.src='https://via.placeholder.com/50?text=MVP'">
            </div>
            <span class="text-white font-black tracking-widest uppercase text-xs md:text-sm">Liga MVP <span class="text-brandpink mx-1">•</span> T22</span>
        </div>
    </nav>

    <header class="relative z-10 pt-12 pb-8 flex flex-col items-center justify-center px-4 text-center">
        <div class="w-28 h-28 md:w-36 md:h-36 mb-6 relative group cursor-pointer">
            <div class="absolute inset-0 bg-brandcyan blur-[30px] opacity-20 group-hover:opacity-40 transition-opacity duration-500 rounded-full"></div>
            <img src="logo.png" alt="Logo" class="w-full h-full object-contain relative z-10 drop-shadow-2xl transition-transform duration-500 group-hover:scale-105" onerror="this.src='https://via.placeholder.com/150?text=LOGO'">
        </div>
        <h1 class="text-5xl md:text-7xl font-black text-gradient uppercase tracking-[0.15em] drop-shadow-sm mb-3">Liga MVP</h1>
        <p class="text-slate-400 text-sm md:text-base tracking-widest uppercase font-semibold">Road to Immortal</p>
    </header>

    <nav class="relative z-10 max-w-6xl mx-auto px-2 md:px-4 mb-8">
        <div class="glass-panel rounded-2xl p-1.5 md:p-2">
            <ul class="flex overflow-x-auto hide-scrollbar snap-x snap-mandatory gap-2" id="nav-divisiones">
                <li class="snap-center shrink-0">
                    <button onclick="cambiarDivision('Superliga', this)" class="btn-division px-5 py-2.5 bg-brandcyan text-black rounded-xl font-bold tracking-wider uppercase text-xs md:text-sm shadow-[0_0_20px_rgba(0,240,255,0.4)] transition-all">
                        Superliga
                    </button>
                </li>
                <li class="snap-center shrink-0">
                    <button onclick="cambiarDivision('Primera', this)" class="btn-division px-5 py-2.5 text-slate-400 hover:text-white hover:bg-white/5 rounded-xl transition-all font-semibold tracking-wider uppercase text-xs md:text-sm">
                        Primera División
                    </button>
                </li>
                <li class="snap-center shrink-0">
                    <button onclick="cambiarDivision('Segunda', this)" class="btn-division px-5 py-2.5 text-slate-400 hover:text-white hover:bg-white/5 rounded-xl transition-all font-semibold tracking-wider uppercase text-xs md:text-sm">
                        Segunda División
                    </button>
                </li>
                <li class="snap-center shrink-0">
                    <button onclick="cambiarDivision('Tercera', this)" class="btn-division px-5 py-2.5 text-slate-400 hover:text-white hover:bg-white/5 rounded-xl transition-all font-semibold tracking-wider uppercase text-xs md:text-sm">
                        Tercera División
                    </button>
                </li>
                <li class="snap-center shrink-0">
                    <button onclick="cambiarDivision('Cuarta', this)" class="btn-division px-5 py-2.5 text-slate-400 hover:text-white hover:bg-white/5 rounded-xl transition-all font-semibold tracking-wider uppercase text-xs md:text-sm">
                        Cuarta División
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    <main class="relative z-10 max-w-6xl mx-auto px-4 pb-20">
        <div class="glass-panel p-4 md:p-8 rounded-[2rem] shadow-2xl relative overflow-hidden">
            
            <div class="flex bg-darkbg/50 rounded-xl p-1.5 mb-8 border border-white/5 relative z-10">
                <button onclick="changeTab('posiciones')" id="btn-posiciones" class="flex-1 py-3 text-xs md:text-sm font-bold uppercase tracking-widest rounded-lg bg-panelbg text-white shadow-lg transition-all border border-white/5">Posiciones</button>
                <button onclick="changeTab('equipos')" id="btn-equipos" class="flex-1 py-3 text-xs md:text-sm font-bold uppercase tracking-widest rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all">Equipos</button>
                <button onclick="changeTab('fixture')" id="btn-fixture" class="flex-1 py-3 text-xs md:text-sm font-bold uppercase tracking-widest rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all">Fixture</button>
            </div>

            <div id="tab-posiciones" class="tab-content active relative z-10">
                <div class="w-full overflow-x-auto hide-scrollbar pb-4">
                    <table class="w-full text-left border-collapse min-w-[600px]">
                        <thead>
                            <tr class="text-slate-500 text-[10px] md:text-xs uppercase tracking-[0.2em] border-b border-white/10">
                                <th class="pb-4 px-4 font-bold">Pos</th>
                                <th class="pb-4 px-4 font-bold">Equipo</th>
                                <th class="pb-4 px-4 text-center font-bold">V</th>
                                <th class="pb-4 px-4 text-center font-bold">D</th>
                                <th class="pb-4 px-4 text-right font-bold text-brandcyan">Pts</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm md:text-base" id="tabla-body"></tbody>
                    </table>
                </div>
            </div>

            <div id="tab-equipos" class="tab-content relative z-10">
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6" id="grid-equipos"></div>
            </div>

            <div id="tab-fixture" class="tab-content relative z-10">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4 bg-darkbg/50 p-4 rounded-xl border border-white/5">
                    <span class="text-brandpink font-bold uppercase tracking-widest text-sm" id="titulo-fecha">Fecha 1</span>
                    
                    <select id="selector-fecha" onchange="cargarFixture(this.value)" class="bg-cardbg border border-white/10 text-white text-sm rounded-lg focus:ring-brandcyan focus:border-brandcyan block px-4 py-2 outline-none cursor-pointer">
                        <option value="1">Fecha 1</option>
                        <option value="2">Fecha 2</option>
                        <option value="3">Fecha 3</option>
                        <option value="4">Fecha 4</option>
                        <option value="5">Fecha 5</option>
                        <option value="6">Fecha 6</option>
                        <option value="7">Fecha 7</option>
                        <option value="8">Fecha 8</option>
                        <option value="9">Fecha 9</option>
                    </select>
                </div>

                <div class="space-y-3" id="contenedor-partidos">
                    </div>
            </div>

        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/appwrite@14.0.1"></script>
    <script>
        // Variables Globales de Estado
        let divisionActual = 'Superliga'; // Inicia mostrando la Superliga por defecto

        // Función para cambiar las pestañas internas (Posiciones, Equipos, Fixture)
        function changeTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('[id^="btn-"]').forEach(btn => {
                btn.classList.remove('bg-panelbg', 'text-white', 'shadow-lg', 'border', 'border-white/5');
                btn.classList.add('text-slate-400');
            });
            setTimeout(() => { document.getElementById('tab-' + tabName).classList.add('active'); }, 50);
            const activeBtn = document.getElementById('btn-' + tabName);
            activeBtn.classList.remove('text-slate-400');
            activeBtn.classList.add('bg-panelbg', 'text-white', 'shadow-lg', 'border', 'border-white/5');
        }

        // --- LÓGICA: Cambiar de División ---
        function cambiarDivision(nuevaDivision, botonClickeado) {
            // 1. Evitar recargar si ya estamos en esa división
            if(divisionActual === nuevaDivision) return;
            
            divisionActual = nuevaDivision;

            // 2. Resetear el diseño de todos los botones de división
            document.querySelectorAll('.btn-division').forEach(btn => {
                btn.className = 'btn-division px-5 py-2.5 text-slate-400 hover:text-white hover:bg-white/5 rounded-xl transition-all font-semibold tracking-wider uppercase text-xs md:text-sm';
            });

            // 3. Encender el botón que fue clickeado (Estilo Activo)
            botonClickeado.className = 'btn-division px-5 py-2.5 bg-brandcyan text-black rounded-xl font-bold tracking-wider uppercase text-xs md:text-sm shadow-[0_0_20px_rgba(0,240,255,0.4)] transition-all';

            // 4. Volver a llamar a la base de datos para que traiga los equipos y fixture de esa liga
            document.getElementById('selector-fecha').value = "1";
            cargarPosiciones();
            cargarEquipos();
            cargarFixture(1);
        }

        // --- INICIALIZACIÓN DE APPWRITE ---
        const { Client, Databases, Storage, Query } = Appwrite;
        const client = new Client().setEndpoint('https://cloud.appwrite.io/v1').setProject('684a25050005e78945d0');
        const databases = new Databases(client);
        const storage = new Storage(client); 

        const DATABASE_ID = '685b5b2c002eb8e5919e'; 
        const POSICIONES_COLLECTION_ID = '69a2367f003b36b1cbec';
        const EQUIPOS_COLLECTION_ID = '69a2329d0030c5c309a8';
        const BUCKET_ID = '69a236b00003fa458197'; 

        const loaderHTML = `<tr><td colspan="5" class="py-12 text-center"><svg class="animate-spin h-8 w-8 text-brandcyan mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="text-slate-400 text-sm tracking-widest uppercase">Buscando datos de ${divisionActual}...</span></td></tr>`;

        // Modificado para filtrar por división
        async function cargarPosiciones() {
            const tbody = document.getElementById('tabla-body');
            tbody.innerHTML = loaderHTML;

            try {
                const response = await databases.listDocuments(
                    DATABASE_ID,
                    POSICIONES_COLLECTION_ID,
                    [
                        Query.equal('division', divisionActual), 
                        Query.orderDesc('puntos')
                    ]
                );

                tbody.innerHTML = '';
                if(response.documents.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="5" class="py-12 text-center text-slate-500 font-semibold tracking-wider uppercase text-sm">No hay equipos en la ${divisionActual}</td></tr>`;
                    return;
                }

                response.documents.forEach((equipo, index) => {
                    const isTop1 = index === 0;
                    const indexStyle = isTop1 ? 'text-brandcyan text-lg drop-shadow-[0_0_8px_rgba(0,240,255,0.8)]' : 'text-slate-500';
                    const rowHover = isTop1 ? 'hover:bg-brandcyan/5' : 'hover:bg-white/5';

                    const fila = `
                        <tr class="border-b border-white/5 ${rowHover} transition-colors duration-300 group">
                            <td class="py-5 px-4 font-black ${indexStyle} w-12">${index + 1}</td>
                            <td class="py-5 px-4 font-bold text-white flex items-center gap-4">
                                <div class="w-10 h-10 bg-darkbg rounded-xl flex items-center justify-center text-xs border border-white/10 shadow-lg uppercase overflow-hidden relative">
                                    <div class="absolute inset-0 opacity-20" style="background-color: ${equipo.color_hex || '#00F0FF'}"></div>
                                    <span class="relative z-10 font-black tracking-widest text-slate-200">${equipo.abreviatura || 'XX'}</span>
                                </div> 
                                <span class="whitespace-nowrap group-hover:text-brandcyan transition-colors">${equipo.nombre_equipo}</span>
                            </td>
                            <td class="py-5 px-4 text-center text-emerald-400 font-black">${equipo.victorias || 0}</td>
                            <td class="py-5 px-4 text-center text-slate-500 font-bold">${equipo.derrotas || 0}</td>
                            <td class="py-5 px-4 text-right font-black text-brandcyan text-xl drop-shadow-[0_0_10px_rgba(0,240,255,0.3)]">${equipo.puntos || 0}</td>
                        </tr>
                    `;
                    tbody.insertAdjacentHTML('beforeend', fila);
                });
            } catch (error) {
                console.error('Error al cargar posiciones:', error);
                tbody.innerHTML = '<tr><td colspan="5" class="py-12 text-center text-brandpink text-sm tracking-widest uppercase">Error conectando con la base de datos</td></tr>';
            }
        }

        // Modificado para filtrar por división
        async function cargarEquipos() {
            const contenedor = document.getElementById('grid-equipos');
            contenedor.innerHTML = '<div class="col-span-full py-12 text-center text-slate-500 text-sm tracking-widest uppercase">Cargando escuadras...</div>';
            
            try {
                const response = await databases.listDocuments(
                    DATABASE_ID,
                    EQUIPOS_COLLECTION_ID,
                    [
                        Query.equal('division', divisionActual) 
                    ]
                );

                contenedor.innerHTML = '';
                if(response.documents.length === 0) {
                    contenedor.innerHTML = `<div class="col-span-full py-12 text-center text-slate-500 text-sm tracking-widest uppercase">No hay equipos en la ${divisionActual}</div>`;
                    return;
                }

                response.documents.forEach(equipo => {
                    let logoUrl = 'https://via.placeholder.com/150/0D1424/FFFFFF?text=MVP'; 
                    if (equipo.logo_id) logoUrl = storage.getFilePreview(BUCKET_ID, equipo.logo_id).href;

                    const tarjeta = `
                        <div class="glass-panel rounded-2xl p-5 flex flex-col items-center justify-center gap-4 hover:border-brandcyan/50 hover:shadow-[0_0_30px_rgba(0,240,255,0.15)] transition-all duration-300 cursor-pointer group">
                            <div class="w-20 h-20 md:w-24 md:h-24 bg-darkbg rounded-full flex items-center justify-center border border-white/10 group-hover:scale-110 group-hover:border-brandcyan/50 transition-all duration-500 overflow-hidden relative shadow-inner">
                                <img src="${logoUrl}" alt="Logo" class="w-full h-full object-cover relative z-10">
                            </div>
                            <span class="text-xs md:text-sm font-bold text-center text-white line-clamp-1 tracking-wider uppercase">${equipo.nombre || equipo.nombre_equipo}</span>
                        </div>
                    `;
                    contenedor.insertAdjacentHTML('beforeend', tarjeta);
                });

            } catch (error) {
                console.error('Error al cargar equipos:', error);
            }
        }

        // --- NUEVA FUNCIÓN: Cargar Fixture ---
        async function cargarFixture(fecha) {
            const contenedor = document.getElementById('contenedor-partidos');
            document.getElementById('titulo-fecha').innerText = `Fecha ${fecha}`;
            
            contenedor.innerHTML = `<div class="py-8 text-center text-slate-500"><svg class="animate-spin h-6 w-6 text-brandcyan mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Cargando enfrentamientos...</div>`;

            try {
                // PARTIDOS_COLLECTION_ID es '69a236290007c639316f'
                const response = await databases.listDocuments(
                    DATABASE_ID,
                    '69a236290007c639316f', 
                    [
                        Query.equal('division', divisionActual),
                        Query.equal('fecha_numero', parseInt(fecha))
                    ]
                );

                contenedor.innerHTML = '';
                if(response.documents.length === 0) {
                    contenedor.innerHTML = `<div class="py-8 text-center text-slate-500 text-sm tracking-widest uppercase">Aún no hay partidos programados para la Fecha ${fecha} en ${divisionActual}</div>`;
                    return;
                }

                response.documents.forEach(partido => {
                    let logoA = 'https://via.placeholder.com/150/0D1424/FFFFFF?text=A';
                    let logoB = 'https://via.placeholder.com/150/0D1424/FFFFFF?text=B';
                    
                    if (partido.equipo_a_logo) logoA = storage.getFilePreview(BUCKET_ID, partido.equipo_a_logo).href;
                    if (partido.equipo_b_logo) logoB = storage.getFilePreview(BUCKET_ID, partido.equipo_b_logo).href;

                    const tarjeta = `
                        <div class="flex justify-center items-center gap-2 md:gap-6 glass-panel p-3 md:p-4 rounded-xl hover:bg-white/5 transition-colors border-l-4 border-l-transparent hover:border-l-brandcyan">
                            <div class="w-[40%] flex justify-end items-center gap-3">
                                <span class="font-bold text-white text-[10px] md:text-sm text-right line-clamp-1">${partido.equipo_a_nombre}</span>
                                <div class="w-8 h-8 md:w-10 md:h-10 bg-darkbg rounded-full border border-white/10 overflow-hidden shrink-0">
                                    <img src="${logoA}" class="w-full h-full object-cover" alt="${partido.equipo_a_nombre}">
                                </div>
                            </div>
                            
                            <div class="bg-darkbg px-3 py-1 md:px-5 md:py-2 rounded-lg font-black tracking-widest text-white border border-white/10 flex items-center gap-2 shrink-0">
                                <span class="text-brandpink">${partido.resultado_a}</span>
                                <span class="text-slate-500">-</span>
                                <span class="text-brandcyan">${partido.resultado_b}</span>
                            </div>

                            <div class="w-[40%] flex justify-start items-center gap-3">
                                <div class="w-8 h-8 md:w-10 md:h-10 bg-darkbg rounded-full border border-white/10 overflow-hidden shrink-0">
                                    <img src="${logoB}" class="w-full h-full object-cover" alt="${partido.equipo_b_nombre}">
                                </div>
                                <span class="font-bold text-white text-[10px] md:text-sm text-left line-clamp-1">${partido.equipo_b_nombre}</span>
                            </div>
                        </div>
                    `;
                    contenedor.insertAdjacentHTML('beforeend', tarjeta);
                });

            } catch (error) {
                console.error('Error al cargar fixture:', error);
                contenedor.innerHTML = '<div class="py-8 text-center text-brandpink text-sm uppercase">Error al cargar los partidos</div>';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            cargarPosiciones();
            cargarEquipos();
            cargarFixture(1); // Carga la fecha 1 por defecto al iniciar
        });
    </script>
</body>
</html>
